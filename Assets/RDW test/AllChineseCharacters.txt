试次实验完成准备开始普通模式加速模式直线弯曲察觉未察觉到检测阈值已！旋转增益曲率增益等待开始试次进行中等待用户响应试次完成实验完成阈值测定实验初始化完成试次开始增益值试次完成等待用户响应用户响应正确实验完成条件阈值响应面板未设置UI试次开始实验已完成UI实验完成阈值年龄组参与者ID初始值初始步长精细步长曲率半径米控制器Redirector数据记录器UI控制器GlobalConfiguration引用RedirectionManager引用Staircase控制器旋转增益Redirector用于旋转条件曲率增益Redirector用于曲率条件数据记录器UI控制器阈值测定实验的主管理器协调staircaseredirectorUI和数据记录实验条件类型年龄组儿童岁成人岁参与者ID旋转增益初始值旋转增益初始步长旋转增益精细步长曲率半径初始值米曲率半径初始步长米对应度米曲率半径精细步长米对应度米初始化实验初始化数据记录器配置staircase参数对于曲率我们需要将半径转换为增益值或者直接在staircase中使用半径这里我们使用一个转换函数或者直接使用半径值为了简化我们可以让staircase直接使用半径值较大的值对应较小的曲率设置UI等待开始试次进行中等待用户响应试次完成实验完成开始下一个试次获取下一个试次的增益值应用增益到对应的Redirector同时更新GlobalConfiguration如果代码需要通知UI试次开始试次开始增益值试次完成等待用户响应显示响应UI试次完成等待用户响应用户提交响应用户是否察觉到增益true察觉到false未察觉到判断响应是否正确对于正常trialresponseDetectedtrue表示用户察觉到增益正确对于catchtrial应该总是察觉但我们仍然记录用户的响应提交结果到staircase更新UI用户响应正确继续下一个试次等待后开始下一个试次完成实验计算阈值记录数据更新UI实验完成条件阈值获取当前状态获取当前试次的增益值强制结束实验阈值测定实验的UI控制器实现2AFC二选一强制选择界面儿童友好设计主Canvas响应选择面板旋转任务普通模式按钮表情笑脸旋转任务加速模式按钮表情火焰曲率任务直线按钮表情铅笔曲率任务弯曲按钮表情香蕉状态信息文本试次信息文本完成信息文本按钮点击后隐藏UI的延迟时间秒初始化UI设置按钮事件初始隐藏响应面板试次开始时的UI更新隐藏响应面板更新状态信息试次开始显示响应UI响应面板未设置根据条件显示对应的按钮旋转任务显示普通和加速按钮曲率任务显示直线和弯曲按钮旋转任务响应选择用户选择加速模式表示察觉到了旋转增益延迟隐藏UI曲率任务响应选择用户选择弯曲表示察觉到了曲率增益响应提交后的UI更新更新状态信息可选显示反馈颜色实验完成时的UI更新延迟隐藏响应UI显示消息用于调试或提示实现updown自适应阶梯法收敛于的探测概率阈值点初始增益值初始步长较粗糙阶段精细步长收敛阶段切换到精细步长所需的反转次数最大试次数量最小反转次数达到此数量后可以终止Catchtrial的概率Catchtrial使用的增益值应该很容易察觉当前状态连续正确次数用于down规则历史记录反转点记录用于计算阈值试次数据试次编号增益值是否为catchtrial用户是否察觉到增益初始化staircase获取下一个试次的增益值Staircase已经完成无法获取新的试次增益判断是否为catchtrial提交试次结果并更新staircase用户是否察觉到增益对于catchtrial应该总是true是否应该继续实验Staircase已经完成无法提交新的结果Catchtrial处理catchtrial不计入staircase逻辑Catchtrial只是用来检测用户是否在认真作答不计入staircase逻辑gain值保持不变检查是否应该终止继续实验正常trial的updown规则down连续次正确减小增益变难检查是否发生反转从增大变为减小或从减小变为增大发生了反转上次是错误增益增大这次是正确增益减小记录反转点切换到精细步长up次错误增大增益变易检查是否发生反转上次是正确增益减小这次是错误增益增大记录试次数据检查是否应该终止继续实验获取最后一个非catchtrial的数据判断是否应该终止实验达到最大试次数量达到最小反转次数计算检测阈值使用反转点的平均值没有足够的反转点来计算阈值排除前个反转点不稳定阶段计算剩余反转点的平均值排除前个反转点获取当前状态信息试次反转当前增益步长获取所有试次历史获取反转点列表检查是否已完成获取当前试次计数获取反转次数阈值测定专用的旋转增益Redirector精确控制旋转增益值用于旋转增益阈值测定实验旋转增益值无增益增益阈值度秒低于此值的旋转不应用增益是否仅在快速旋转时应用增益用于旋转任务从StaircaseController设置旋转增益值获取当前旋转增益值检查旋转速度是否超过阈值应用旋转增益增益公式例如应用增益度额外旋转如果不需要仅在快速旋转时应用则对所有旋转应用增益获取最后一次应用的增益值阈值测定专用的曲率增益Redirector基于S2C算法但精确控制曲率半径用于曲率增益阈值测定实验曲率半径米较小的半径产生更大的曲率曲率增益上限度秒移动阈值米秒低于此值的移动不应用曲率增益从StaircaseController设置曲率半径确保半径不为或负数同时更新GlobalConfiguration中的CURVATURE_RADIUS如果代码需要注意这里只是临时使用不应该永久修改GlobalConfiguration如果需要可以添加一个临时参数来存储获取当前曲率半径将曲率半径转换为曲率增益值度米曲率增益半径米弧度米度米使用S2C算法的目标选择逻辑生成临时目标计算曲率增益用户正在移动曲率增益距离半径弧度距离半径度确定转向方向S2C算法逻辑应用曲率增益获取最后一次使用的曲率半径清理临时目标阈值测定实验的数据记录器扩展StatisticsLogger专门记录staircase实验数据数据保存目录相对于项目根目录Staircase数据记录Staircase数据结构年龄组儿童岁成人岁初始化数据记录器创建实验目录数据记录器初始化完成目录记录一个staircase实验的数据立即保存到CSVStaircase数据已记录阈值试次反转保存单个staircase数据到CSV文件写入头部信息写入试次数据数据已保存到保存汇总数据所有条件汇总数据已保存到获取数据目录路径阈值测定实验的简单运行器提供简化的接口来运行实验可以作为参考实现实验管理器引用按键开始下一个试次用于测试按键标记试次完成用于测试自动模式自动开始试次和等待响应自动模式立即开始第一个试次ThresholdExperimentManager未找到键盘控制用于测试开始第一个试次用于自动模式标记试次完成用于任务完成时调用提交用户响应用于UI按钮调用